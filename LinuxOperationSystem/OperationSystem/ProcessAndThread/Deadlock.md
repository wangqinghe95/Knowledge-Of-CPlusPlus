# 死锁
## 定义
+ 两个及两个以上的线程或者进程在执行的过程中，由于资源的竞争而造成的阻塞，并且在没有外来的介入下阻塞的进程都无法继续执行下去的一种现象称之为死锁
+ A，B 两个线程都共享 1，2 两种资源，A 对 1 加锁后去申请 2，B 对 2 加锁后去申请 1，就会出现死锁的情况

## 原因
1. 系统资源不足
2. 程序执行顺序不当
3. 资源分配不当

## 产生死锁的必要条件
1. 互斥条件：每个资源每次只能被一个进程占用
2. 请求与保持条件：一个进程因请求资源阻塞时，不会释放已经申请到的资源
3. 不剥夺条件：进程已获得的资源，在未使用完之前，不可强行剥夺
4. 循环等待条件：若干进程之间形成一种头尾相连的循环等待资源关系

## 死锁解决方法
### 死锁防止
+ 破坏产生死锁的 4 个必要条件之一即可
1. 破坏互斥条件
    + 只读数据、软盘等软硬件资源采用可以同时读
    + 不适用于独占性资源，比如写文件，鼠标，打印机等
2. 破坏占用和等待条件
    + 采用静态分配的方式，即程序在执行之前就必须获取全部的资源
    + 严重降低了资源利用率
3. 破坏不可剥夺条件
    + 占有资源的进程若想申请新的资源，需要先释放已占有的资源
    + 资源分配管理程序为进程分配新的资源时，若有则分配，否则将剥夺此进程已占有的全部资源，并让进程进入资源等待状态，资源充足后再唤醒它重新申请所有资源所需资源
    + 能够防止死锁，但只适合内存和处理器资源
4. 破坏循环等待条件
    + 给系统的所有资源编号，规定进程请求所需资源的顺序必须按照资源的编号依次申请进行
    + 一个进程申请到某层的一个资源后，只能申请较高一层的资源
    + 当进程释放某层的一个资源时，必须释放所占有的较高层的资源
    + 当进程获得某层的一个资源时，如果想要申请同层的另一个资源，必须释放此层中已占有的资源
2. 死锁避免
    + 银行家算法：系统在分配资源之前，会计算此次分配资源的安全，即分配资源之后不会导致系统进入不安全状态
3. 死锁检测

4. 死锁恢复
+ 资源剥夺法
    - 剥夺陷于死锁的进程所占用的资源，但并不撤销该进程，直至死锁解除
+ 进程回退法
    - 根据系统保存的检查点让所有进程回退，直到足以解除死锁，该措施要求系统建立保存检查点、回退以及重启机制
+ 进程撤销法
    - 撤销陷入死锁的所有进程，解除死锁，继续运行
    - 逐个撤销陷入死锁的进程，回收其资源并重新分配，直至死锁解除